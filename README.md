# HELIOS : R√©duction de l'impact √©cologique du service num√©rique d'un √©tablissement de m√©t√©orologie et de climatologie

## Choix du sujet
Nous revenons tous deux d'un semestre √† l'√©tranger dans deux pays avec une m√©t√©o tr√®s distincte. En Norv√®ge la m√©t√©o √©tait particuli√®rement changeante et extr√™me par moments. Consulter la m√©t√©o chaque jour est devenu une habitude, de m√™me que la programmation journali√®re d'une notification r√©capitulative.

Aussi, nous nous sommes rendus compte que les habitudes de consommation des services de m√©t√©o sont tr√®s diff√©rentes selon les r√©gions du monde et leur climat. Dans les pays aux climats extr√™mes, les habitants consultent plus r√©guli√®rement ces services pour pr√©venir les averses ou √©v√®nements climatiques (orages, ouragans, canicules, etc). Avec le d√©r√®glement climatique, le nombre de ces √©v√®nements ne va qu'augmenter, ce qui fait que le nombre de potentiels utilisateurs ne va cesser de cro√Ætre ([source: Courrier International](https://www.courrierinternational.com/article/technologie-face-au-rechauffement-climatique-les-applications-de-meteo-ont-le-vent-en-poupe)).

M√©t√©o France est le principal service de m√©t√©o en France avec plus de 11 millions utilisateurs mensuels. C'est une r√©f√©rence en la mati√®re, mais en remarquant le poids et la complexit√© du site, nous nous sommes attach√©s √† concevoir une alternative avec un plus faible impact environnemental.


## Utilit√© sociale

A une √©poque o√π la situation climatique est de plus en plus incertaine et changeante, se renseigner sur la m√©t√©o est primordial. De plus, regarder la m√©t√©o du jour est une action quotidienne pour des millions d'utilisateurs et touche un large public. 
En plus d'informer sur la m√©t√©o nationale, un tel service se doit de sensibiliser sur le r√©chauffement climatique et les catastrophes m√©t√©orologiques qu'il cause. 

M√©t√©o France est un √©tablissement public √† caract√®re administratif ([source : M√©t√©o France](https://meteofrance.fr/etablissement)) charg√© de missions en mati√®re de s√©curit√© m√©t√©orologique des personnes et des biens. C'est un √©tablissement qui remplit une mission d'int√©r√™t g√©n√©ral sous contr√¥le de l'Etat. Son service num√©rique est donc reconnu pour son utilit√© sociale.

## Effets de la num√©risation

L'histoire des pr√©visions m√©t√©oroligiques est relativement jeune et connait son av√®nement avec l'informatique et les satellites. Avant le Web c'est via la presse √©crite et la radio que les pr√©visions √©taient communiqu√©es.
D√©sormais c'est via des applications mobiles principalement qu'elle est diffus√©e. On en comptait plus de 10 000 en 2023 et ce nombre ne va cesser d'augmenter. Cependant l'√©norme majorit√© des services se basent uniquement sur l'un des cinq mod√®les ouverts suivants :

- Mod√®le europ√©en ECMWF,
- Mod√®le am√©ricain GFS,
- Mod√®le fran√ßais Arome (M√©teo France),
- Mod√®le fran√ßais Arp√®ge (M√©teo France),
- Mod√®le allemand Icon.

([source : Lib√©ration](https://www.liberation.fr/environnement/climat/face-a-meteo-france-des-concurrents-comme-sil-en-pleuvait-20240318_NKJTT4HMXJFERBRJYU2YHJVY3E/))

En 2022 le march√© mondial des services de pr√©visions m√©t√©orologiques pesait 2,20 milliards d'euros, et c'est un chiffre qui est attendu √† la hausse pour les ann√©es √† suivre ([source : Statista](https://www.statista.com/outlook/dmo/app/weather/worldwide)).

L'impact √©cologique de cette substitution du papier et de la radio par les applications mobiles est compliqu√© √† √©tablir. N√©anmoins √©tant donn√© le changement des habitudes de consommation des utilisateurs et la multiplication des plateformes m√©t√©o, il para√Æt pertinent de proposer une alternative plus sobre. Avec l'essor de l'IA, les GAFAM s'int√©ressent √©galement √† la pr√©vision m√©t√©orologique pour tenter de produire des mod√®les toujours plus pr√©cis. Ces petites am√©liorations de performance ne sont pas forc√©ment n√©cessaires et ont un fort impact environnemental car elles n√©cessitent de nombreux serveurs et √©quipements num√©riques.

## Axes de travail

Notre premier axe de travail sera dirig√© autour des publicit√©s du site de m√©t√©o france. En effet, le site contient de nombreuses images et vid√©os provenant de publicit√© ainsi que des "pop-ups". Pour r√©duire l'impact √©cologique de la page, mais aussi r√©duire le temps de chargement, il nous para√Æt pertinent de les supprimer pour obtenir une page plus √©pur√©e. 
Dans un second temps, nous souhaitons √©galement enlever la grande majorit√© des articles en fin de page. Sur la page d'accueil du site, la seconde partie est uniquement constitu√©e d'articles avec une image ou vid√©o pour le pr√©senter. Toujours dans la m√™me optique, nous souhaitons rendre la page plus pertinente et moins √©nergivore en ne laissant qu'un article. De ce fait, l'utilisateur aura plus de chances √©galement de s'int√©resser s'il n'est pas submerg√© par la quantit√©. 
Toujours pour les m√™mes raisons, nous allons remplacer la carte de france qui est l'√©l√©ment central de la page. Il sera possible par exemple de la remplacer par un tableau des temp√©ratures et conditions m√©t√©orologiques tout au long de la journ√©e.
Enfin, l'application se doit √©galement d'√™tre accessible et pertinente pour le plus grand nombre. Ainsi, nous ajouterons une partie professionnelle, notamment avec la m√©t√©o agricole pour les utilisateurs qui auront besoin d'informations compl√©mentaires et plus pr√©cises pour centraliser les informations dans un m√™me endroit.


## Sc√©nario 1 : Consulter la m√©t√©o
1. L'utilisateur de m√©t√©o en ligne se rend sur la page d'accueil gr√¢ce √† un favori (donc sans passer par un moteur de recherche). Il cherche l'onglet m√©t√©o de sa r√©gion.
2. Il choisit de voir la m√©t√©o de sa r√©gion.
3. Il consulte la m√©t√©o du lendemain et des jours prochains.


## Sc√©nario 2 : Consulter des articles
1. L'utilisateur de m√©t√©o en ligne se rend sur la page d'accueil gr√¢ce √† un favori (donc sans passer par un moteur de recherche). Il consulte les titres.
2. Il choisit un des articles et le lit en entier.
3. Il choisit un autre article √† consulter parmi ceux pr√©sents en bas.
4. Il le lit jusqu'au bout


## Impact de l'ex√©cution des sc√©narios aupr√®s de diff√©rents services concurrents

L'EcoIndex d'une page (de A √† G) est calcul√© (sources : [EcoIndex](https://www.ecoindex.fr/comment-ca-marche/), [Octo](https://blog.octo.com/sous-le-capot-de-la-mesure-ecoindex), [GreenIT](https://github.com/cnumr/GreenIT-Analysis/blob/acc0334c712ba68939466c42af1514b5f448e19f/script/ecoIndex.js#L19-L44)) en fonction du positionnement de cette page parmi les pages mondiales concernant :

- le nombre de requ√™tes lanc√©es,
- le poids des t√©l√©chargements,
- le nombre d'√©l√©ments du document.

Nous avons choisi de comparer l'impact des sc√©narios sur les services de quotidiens nationaux de diverses sensibilit√©s politiques, √©conomiques et environementales :

- M√©t√©o France,
- Yr,
- M√©t√©o Agricole.

Les r√©sultats sont les suivants (attention, d'une journ√©e √† l'autre, on peut observer une certaine variabilit√©) :

- Sc√©nario "[Consulter la m√©t√©o de ma r√©gion](https://htmlpreview.github.io/?https://raw.githubusercontent.com/UTT-GL03/helios/main/benchmark/consulterMeteo/results.html)",
- Sc√©nario "[Lire des articles parmi les articles de la page d'accueil](https://htmlpreview.github.io/?https://raw.githubusercontent.com/UTT-GL03/helios/main/benchmark/scenarioArticle/benchmark_.html)".

Les r√©sultats de performance sont assez diff√©rents entre M√©t√©o France, Yr et la M√©t√©o Agricole. M√©t√©o France et la M√©t√©o Agricole ont beaucoup de pubs et de cookies qui alourdissent la page et augmente le r√©seau n√©cessaire.

On peut aussi noter le nombre de requ√™tes n√©cessaires. Par exemple, pour charger la page d'accueil Meteo France il faut 75 requ√™tes HTTP. Cela confirme bien notre volont√© de r√©duction du nombre d'articles et des images associ√©es.
√Ä noter que les diff√©rents r√©sultats qu'ils soient la taille du DOM ou encore la taille de la page sont directement en corr√©lation avec les axes d'am√©liorations que nous avions envisag√©s. En effet, Meteofrance qui poss√®de la carte de la France, les articles, et des vid√©os poss√®de le score le moins bon. Les deux autres sites test√©s respectent la m√™me logique : moins il y a de features interactives et gourmandes en ressources,  meilleur est le score d'ecoIndex.

## Maquette de l'interface et √©chantillon de donn√©es

Au vu des diff√©rents services compar√©s, des exigences environnementales exprim√©es plus haut et des sc√©narios retenus, nous avons d√©fini pour notre prototype une maquette de l'interface et un √©chantillon de donn√©es r√©alistes.

L'interface retenue est compos√©e de deux types de "pages Web" :

- celle d'accueil, contenant la m√©t√©o du jour des principales villes fran√ßaises,
- celle qui donne plus d'informations sur la m√©t√©o d'une zone donn√©e ("interface pro").

![Maquette de la page d'accueil](./wireframe/FirstWireFrame.png)
__Fig.1__: Maquette de l'interface d'accueil du prototype

![Maquette de la page pro](./wireframe/ProPageWireFrame.png)
__Fig.2__: Maquette de l'interface pro du prototype


Pour des raisons de respect des droits d'auteurs, nous utilisons des donn√©es g√©n√©r√©es (avec [`dummy-json`](https://dummyjson.com)).
Bien que fictives, ces donn√©es correspondent √† la structure des services concurrents : 3 villes comportant la m√©t√©o pour chacun (temp√©rature, vent, m√©t√©o) sur 7 jours (voir [mod√®le de donn√©es](./frontend/sample_data.hbs)). 


## Prototype n¬∞1 : Fonctionnalit√©s pour le sc√©nario prioritaire avec donn√©es statiques

Pour cette premi√®re version du prototype :

- l'√©chantillon de donn√©es est encore charg√© dans le code de mani√®re statique,
- les fonctionnalit√©s impl√©ment√©es ne sont que celles n√©cessaires pour suivre le sc√©nario prioritaire ("Consulter la m√©t√©o").

Ce sc√©nario n√©cessite de pouvoir naviguer sur la page principale qui contient la m√©t√©o du jour. On se sert ensuite de la barre de recherche pour trouver la m√©t√©o de la ville qui nous int√©resse.

### Page principale

Nous avons donc d√©velopp√© la page d'accueil pour qu'elle affiche un √©chantillon de donn√©es m√©t√©o sous la forme d'un tableau, comme pr√©vu par la maquette. Elle affiche la m√©t√©o du jour pour 3 villes si aucune recherche n'est faite (cf. Fig. 3) et affiche la m√©t√©o de la semaine si l'utilisateur recherche une ville en particulier (cf. Fig. 4)

![Maquette de la page pro](./wireframe/mainPage.png)
__Fig.3__: Prototype de la page principal 

![Maquette de la page pro](./wireframe/mainPageResearch.png)
__Fig.4__: Prototype de la page principal avec une recherche

Pour l'instant, nous avons choisi le framework de mise en page minimaliste (PicoCSS). Dans la suite du projet, nous verrons si l'impact environnemental du passage √† un framework de mise en page plus puissant (comme Bootstrap ou Tailwind) est acceptable.

Nous avons choisi une librairie qui permet l'import d'icones pour afficher de mani√®re plus ludique la m√©t√©o. Par la suite, nous √©tudierons l'impact de l'utilisation d'une librairie par rapport √† l'import des fichiers .svg dans le projet.

Nous avons d√©cid√©, contrairement √† l'ensemble des services concurrents, de ne pas surcharger la page d'informations, d'articles ou encore d'une carte interactive qui n√©cessite beaucoup de ressource. 
Si de telles fonctionnalit√©s devaient √™tre introduites, il faudrait mettre en balance leurs utilit√©s et leurs impacts a priori important.

Dans l'√©tat actuel du prototype, il est possible d'avoir une premi√®re id√©e de l'impact environnemental du frontend. Bien entendu, il manque encore le chargement dynamique des donn√©es, mais nous pouvons d√©j√† √©valuer l'impact de l'affichage des donn√©es et du framework (au sens large : React, PicoCSS, DayJS). Cette √©valuation de l'impact (cf. Tab.1) est d√©j√† encourageante en mode "d√©veloppement" mais encore plus en mode "pr√©-production". Nous mesurons ici l'effet positif de l'adoption d'outils de d√©veloppement Web int√©grant la ["minification"](https://fr.wikipedia.org/wiki/Minification) (cf. *Wikip√©dia*) du code et la concat√©nation du code d'une part et des feuilles de style d'autre part.



|   | EcoIndex| GES (gCO2e) | Taille du DOM | Requ√™tes | Taille de la page (ko)
|---|--------:|------------:|--------------:|---------:|---------------------:
| Mode "d√©veloppement"  | 76 Büü¢ |  1,4 | 64 | 24 | 4609
| Mode "pr√©-production" | 93 Aüü¢ | 1,14 | 61 | 4 | 76 

__Tab.1__: √âvaluation de l'impact du prototype de la page d'accueil.




Avec l'ajout de ce mod√®le de page et la mise en place de la navigation entre les deux mod√®les, il devient possible d'ex√©cuter le sc√©nario prioritaire complet et de mesurer son impact.

|   | EcoIndex| GES (gCO2e) | Taille du DOM | Requ√™tes | Taille de la page (ko)
|---|--------:|------------:|--------------:|---------:|---------------------:
| 1. Consulter la m√©t√©o des villes de l'accueil 					   | 93 Aüü¢ |  1,14 | 61 | 4 | 76
| 2. rechercher  une ville			   | 91 Aüü¢ | 1,77 | 97 | 4 | 102
| 3. Revenir √† l'accueil | 91 Aüü¢ | 1,77 | 97 | 4 | 102


__Tab.2__: √âvaluation de l'impact du sc√©nario "rechercher la m√©t√©o d'une ville" dans le prototype n¬∞1.



## Prototype n¬∞2 : Fonctionnalit√©s pour le sc√©nario prioritaire avec donn√©es statiques charg√©es de mani√®re dynamique

Pour cette deuxi√®me version du prototype, les donn√©es (toujours statiques) sont d√©sormais charg√©es par le frontend √† travers le r√©seau imm√©diatement apr√®s un premier affichage √† vide. Ce comportement, plus r√©aliste, n'a pour effet qu'une requ√™te suppl√©mentaire par page affich√©e.

Concernant l'√©valuation de l'impact environemental du sc√©nario, par rapport au tableau pr√©c√©dent (cf. Tab.2), √† l'exception du nombre de requ√™tes qui est incr√©ment√© de 1, les r√©sultats sont strictement identiques.
D'ailleurs, √† partir de cette version, et √† moins de changements profonds, l'EcoIndex ne devrait plus √©voluer de mani√®re significative.
Nous utiliserons d√©sormais un autre logiciel, *GreenFrame*, qui √©value non pas l'impact "environn√©" de la consultation (incorporant une participation au cycle de vie du terminal) mais celui de la consultation proprement dite (cf. Tab.3) et de mani√®re beaucoup plus fiable √† partir des statistiques d'utilisation des ressources physiques (CPU, m√©moire, r√©seau, disque).

| | Impact de la consultation de la m√©t√©o
|--------------|----:
| Meteo France | 302         
| Meteo Blue   | 183
| Meteo Agricole   | 80
| Yr           | 41          
| __HELIOS__ | __31__

__Tab.3__ : Impact en mg CO2e de la consultation proprement dite des pages des services existants et de notre prototype.

Pour les services existants, sur le graphique pr√©sentant l'utilisation dans le temps des ressources (cf. Fig.4), on constate d'autres pics que le pic initial, probablement associ√©s au chargement et √† l'affichage de contenus multim√©dias et de publicit√©s, ou caus√©s par des techniques de pistage sur le Web.

![Impact du journal Le Monde](./benchmark/meteoFrance.png)
__Fig.5__: Consommation de ressources lors de la consultation de la page m√©t√©o *m√©t√©o france*.

Pour notre prototype, au contraire, le graphique (cf. Fig.5) pr√©sente un unique pic significatif de consommation de CPU et de r√©seau.
Notons par ailleurs que le pic de CPU est 40 fois plus faible que celui de la figure pr√©c√©dente.
Par ailleurs, nous remarquons que cette consommation ne compte que pour 3% de la consommation totale, le reste √©tant consomm√© par l'√©cran durant la dur√©e de la mesure.

![Impact du prototype](./benchmark/helios_homepage.png)
__Fig.6__ : Consommation de ressources par le navigateur lors de la consultation de la m√©t√©o dans notre prototype.


## Prototype n¬∞3 : Fonctionnalit√©s pour le sc√©nario prioritaire avec donn√©es stock√©es dans une base de donn√©es

Pour la troisi√®me version du prototype, les donn√©es sont d√©sormais stock√©es dans un syst√®me de base de donn√©es interrogeable √† travers une API Web (*CouchDB*).
L'int√©r√™t d'une source de donn√©es dynamique est d'une part, √† terme, de pouvoir ajouter ou modifier la m√©t√©o plus facilement, et d'autre part de d√©porter sur le serveur le filtrage des donn√©es pertinentes.

Sur ce deuxi√®me enjeu, on observe  dans les mesures (cf. Fig.7) que la charge du r√©seau entre les deux prototypes concernant la consultation de la m√©t√©o est sensiblement la m√™me. Ceci est d√ª √† la simplicit√© de notre application qui ne contient qu'une page √† charger. N√©anmoins, en supposant que notre application contiendra √† terme plusieurs pages et d'autres lots de donn√©es, on peut s'attendre √† une baisse de la charge du r√©seau pour l'aff

![](./benchmark/helios_v2.png)
![](./benchmark/helios_v3.png)
__Fig.7__ : Comparaison de l'impact de la consultation de la page de la m√©t√©o entre les prototypes 2 (en haut) et (3 en bas).

De plus, on peut constater une utilisation du CPU par la base de donn√©es, utilisation qui semble par ailleurs continue et plus important qu'auparavant. (cf. Fig.8).

![](./benchmark/helios_backend_v3.png)
__Fig.8__ : Profil dans le temps de l'impact de la base de donn√©es lors de la consultation de la m√©t√©o.

De ces diff√©rentes mesures, nous pouvons retenir que l'effet de l'introduction d'une base de donn√©es, quoique n√©gligeable, est, pour l'instant, plut√¥t d√©favorable d'un point de vue √©cologique.
Le bilan de ce changement devrait cependant rapidement s'inverser avec l'augmentation de la quantit√© de donn√©es g√©r√©es.


## Prototype n¬∞4 : Fonctionnalit√©s pour le sc√©nario prioritaire avec filtrage des donn√©es

### Passage √† l'√©chelle


Dans le cas qui nous occupe de la presse quotidienne et dans le cadre des fonctionnalit√©s envisag√©es (consultation d'articles), l'augmentation de la quantit√© des donn√©es √† traiter ne viendra ni de l'augmentation du nombre de journalistes ni m√™me de celle  des lecteurs.
Par contre, il est d'usage sur les applications de presse d'avoir acc√®s aux archives du journal,
le but √©tant d'√©clairer l'actualit√© √† la lumi√®re du pass√© plus ou moins proche.
Cette exigence fonctionnelle bien que co√ªteuse du point de vue environnemental nous semble contribuer grandement √† l'utilit√© sociale de la plateforme.
Par cons√©quent nous adopterons √©galement ce choix de conception.

L'augmentation du volume d'articles est lin√©aire : √† raison de 25 nouveaux articles par jour, la base de donn√©es sera de 3000 articles au bout de 4 mois (et ainsi de suite).

### √âvolution de l'impact environnemental avant correction

La figure 9 illustre l'impact du passage √† l'√©chelle de 20 √† 2000 √©l√©ments de m√©t√©o (correspondant √† la m√©t√©o de 133 villes pendant 2 semaines 
 de mani√®re quotidienne).
On observe, sur le *backend*, une multiplication par 16 de l'impact du processeur, et  concernant l'impact du r√©seau, une multiplication par 33 pour le *frontend* et une net augmentation non quantifiable (de 0 √† 5 mWh) pour le *backend*.

![](./benchmark/scale_db.png)
__Fig.9__ : √âvolution de l'impact de la consultation de la m√©t√©o en passant de 20 √©l√©ments √† 2000 (soit 4 mois d'historique).

Dans un site de m√©t√©o, une approche similaire √† celle de la presse num√©rique peut √™tre adopt√©e pour la gestion des donn√©es m√©t√©orologiques. Au lieu de charger toutes les pr√©visions m√©t√©o de l'ann√©e ou d'une longue p√©riode au d√©part, ce qui pourrait entra√Æner une surcharge de donn√©es et une exp√©rience utilisateur moins fluide, nous pouvons opter pour une approche plus progressive.

Voici l'id√©e :

Prise en compte du passage √† l'√©chelle dans l'application m√©t√©o
Au lieu de charger l'int√©gralit√© des pr√©visions m√©t√©o pour toutes les villes sur une longue p√©riode d√®s l'ouverture de l'application, nous adopterons une m√©thode de chargement progressif des donn√©es. Concr√®tement, d√®s l'ouverture de l'application nous commencerons par charger un nombre r√©duit de pr√©visions 10 √©l√©ments de m√©t√©o.

Strat√©gies de chargement des donn√©es :
Affichage initial (3 jours) :

Lorsque l'utilisateur acc√®de √† la page principale de l'application ou √† une page de d√©tails pour une ville donn√©e, seuls les pr√©visions m√©t√©orologiques de 10 dates et/ou villes seront charg√©es. Ces donn√©es peuvent √™tre issues d'une API de m√©t√©o.
Cela permet d'afficher rapidement des informations sans n√©cessiter un gros t√©l√©chargement initial.
Chargement en fonction de la recherche de l'utilisateur :

Si l'utilisateur souhaite consulter des pr√©visions pr√©cise par exemple une ville particuli√®re, l'application chargera  les pr√©visions suppl√©mentaires de la ville concern√© en fonction de la recherche de l'utilisateur. Lorsqu'il fait d√©filer la page ou clique sur un bouton pour voir plus de pr√©visions, l'application enverra une requ√™te √† l'API pour r√©cup√©rer les pr√©visions des jours suivants.

### √âvolution de l'impact environnemental apr√®s correction

La strat√©gie choisie a eu l'effet escompt√© : les mesures d'impact (cf. Fig. 10) montrent que son impl√©mentation a permis de contrecarrer l'augmentation de l'impact environnemental caus√©e par le passage de 30 √† 3000 articles.

![](./benchmark/consumption.png)
__Fig.10__ : √âvolution de l'impact de l'application avec l'augmentation de la quantit√© de donn√©es puis sa prise en compte.

On peut voir un retour √† l'impact d'avant l'augmentation de la quantit√© des donn√©es trait√©es, = notamment sur le r√©seau entre le *backend* et le *frontend* (cf. Fig. 11).
Cette am√©lioration s'explique par le fait que la technique utilis√©e pour filtrer les articles a √©galement permis de choisir les attributs r√©ellement n√©cessaires (et donc de ne plus transf√©rer le contenu des articles pour cette page des titres).

![](./benchmark/helios_final_comparison.png)
__Fig.11__ : Comparaison de l'impact de la page des titres optimis√©e avec 2000 √©l√©ments et non-optimis√©e avec 20 √©l√©ments.